---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "dsm_gcp_ekm_sa Resource - terraform-provider-dsm"
subcategory: ""
description: |-
  Creates a Fortanix DSM Google EKM app. The returned resource object contains the UUID of the app for further references.
---

# dsm_gcp_ekm_sa (Resource)

Creates a Fortanix DSM Google EKM app. The returned resource object contains the UUID of the app for further references.

## Example Usage

```terraform
# Create three normal groups
resource "dsm_group" "group1" {
  name        = "group1"
  description = "group1"
}

resource "dsm_group" "group2" {
  name        = "group2"
  description = "group2"
}

resource "dsm_group" "group3" {
  name        = "group3"
  description = "group3"
}

# Create a Google EKM app in DSM
resource "dsm_gcp_ekm_sa" "ekm_sa" {
  name                    = "service-[PROJECT-NUMBER]@gcp-sa-ekms.iam.gserviceaccount.com"
  default_group           = dsm_group.group1.id
  other_group             = [dsm_group.group2.id, dsm_group.group3.id]
  other_group_permissions = local.other_groups
}


# To modify the default group permissions, other_group_permissions can be used in a zipmap.
# In the above app the following permissions are assigned for each group:
# group1: SIGN,VERIFY,ENCRYPT,WRAPKEY,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT
# group2: SIGN,VERIFY,DECRYPT,WRAPKEY,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT
# group3: SIGN,VERIFY,ENCRYPT,DECRYPT,WRAPKEY,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT

# For group3, default permissions are assigned as it was not specified in the other_group_permissions.
# group should be specified only if default permissions need to be changed.

locals {
  other_groups = zipmap(
    [
      dsm_group.group1.id,
      dsm_group.group2.id
    ],
    [
      "SIGN,VERIFY,ENCRYPT,WRAPKEY,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT",
      "SIGN,VERIFY,DECRYPT,WRAPKEY,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT"
    ]
  )
}

# An example on how to modify the existing permissions of a group in EKM
resource "dsm_gcp_ekm_sa" "ekm_sa" {
  name                    = "service-[PROJECT-NUMBER]@gcp-sa-ekms.iam.gserviceaccount.com"
  default_group           = dsm_group.group1.id
  other_group             = [dsm_group.group2.id, dsm_group.group3.id]
  other_group_permissions = local.other_groups
  # mod_group_permissions should be given while updating an app
  mod_group_permissions = local.mod_groups
}

# group1 and group2 permissions modification
locals {
  mod_groups = zipmap(
    [
      dsm_group.group1.id,
      dsm_group.group2.id
    ],
    [
      "SIGN,VERIFY,ENCRYPT,DECRYPT,WRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT",
      "SIGN,VERIFY,DECRYPT,UNWRAPKEY,DERIVEKEY,MACGENERATE,MACVERIFY,EXPORT,MANAGE,AGREEKEY,AUDIT"
    ]
  )
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `default_group` (String) The Fortanix DSM group ID to be mapped to the app by default.
- `name` (String) The Google service account name.

### Optional

- `description` (String) The description of the app.
- `mod_group_permissions` (Map of String) To modify the permissions of any existing group.
- `other_group` (List of String) The Fortanix DSM group object ID the app needs to be assigned to. If you want to delete the existing groups from an app, remove the IDs during update.
- `other_group_permissions` (Map of String) If you want to change the default permissions of a new group.

### Read-Only

- `acct_id` (String) The account ID from Fortanix DSM.
- `app_id` (String) The unique ID of the app from Terraform.
- `creator` (Map of String) The creator of the security object from Fortanix DSM.
   * `user`: If the security object was created by a user, the computed value will be the matching user ID.
   * `app`: If the security object was created by an app, the computed value will be the matching app ID.
- `id` (String) The ID of this resource.
